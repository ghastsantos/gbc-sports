
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cadastro</title>
    <link href="/styles/stylescadastro.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap" rel="stylesheet">
</head>
<body>
    <section class="header">
        <nav>
            <ul class="lista">
                <div class="logo">
                    <img src="/images/logo.png" style="width: 100px; height: 100px; margin-top: 10px;" alt="logo">
                </div>

                <div class="caixa-search">
                    <input class="caixa-texto" type="text" name="" placeholder="Pesquisar...">
                    <a class="botao-search" href="">
                        <img src="/images/search.png" style="width: 20px; height: 20px;" alt="search">
                    </a>
                </div>

                <div class="paginas-menu">
                    <li><a href="/index.html" class="lista-elemento-link">Início</a></li>
                    <li><a href="/camisas-masculinas.html" class="lista-elemento-link">Camisas Masculinas</a></li>
                    <li><a href="/camisas-femininas.html" class="lista-elemento-link">Camisas Femininas</a></li>
                    <li><a href="/regatas.html" class="lista-elemento-link">Regatas</a></li>
                    <li><a href="/casacos.html" class="lista-elemento-link">Casacos</a></li>
                </div>
                    <a href="/carrinho.html" class="carrinho">
                        <img src="/images/carrinho.png" style="width: 40px; height: 40px; margin-bottom: 10px;" alt="carrinho">
                    </a>
                </div>
                    <a href="perfil.html" class="perfil">
                        <img src="/images/perfil.png" style="width: 40px; height: 40px; margin-bottom: 7px;  margin-left: 30px; justify-content: flex-start;" alt="perfil">
                    </a>
                </div>
            </ul>
            <ul class="lista-celular">
                <div class="paginas-menu-celular">
                    <li><a href="" class="paginaAtual lista-elemento-link">Início</a></li>
                    <li><a href="" class="lista-elemento-link">Camisas</a></li>
                    <li><a href="" class="lista-elemento-link">Regatas</a></li>
                    <li><a href="" class="lista-elemento-link">Casacos</a></li>

                    <div>
                        <a href="carrinho.html" class="carrinho-celular">
                            <img src="/images/carrinho.png" style="width: 40px; height: 40px; margin-bottom: 10px;" alt="carrinho">
                        </a>
                    </div>
                    <div>
                        <a href="perfil.html" class="perfil-celular">
                            <img src="/images/perfil.png" style="width: 50px; height: 50px; margin-bottom: 8px;" alt="perfil">
                        </a>
                    </div>
                </div>
                </div>
                   
            </ul>
        </nav>
    </section>
    <section class="main-container">
        <div class="form-container" style="margin-top: 30px;">
            <h2>Faça seu cadastro!</h2>
            <form>
                <div class="mb-3">
                    <label for="nome" class="form-label">Nome</label>
                    <input type="text" class="form-control" id="nome">
                </div>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email">
                </div>
                <div class="mb-3">
                    <label for="senha" class="form-label">Senha</label>
                    <input type="password" class="form-control" id="senha">
                </div>
                <div class="mb-3">
                    <label for="confirmarsenha" class="form-label">Confirmar a Senha</label>
                    <input type="password" class="form-control" id="confirmarsenha">
                </div>
                <div class="mb-3">
                    <label for="endereco" class="form-label">Endereço</label>
                    <input type="text" class="form-control" id="endereco">
                </div>
                <div class="mb-3">
                    <label for="cidade" class="form-label">Cidade</label>
                    <input type="text" class="form-control" id="cidade">
                </div>
                <div class="mb-3">
                    <label for="estado" class="form-label">Estado (Apenas sigla)</label>
                    <input type="text" class="form-control" id="estado">
                </div>
                <div class="mb-3">
                    <label class="form-label">Data de Nascimento</label>
                    <input class="form-control" id="data" type="date" />
                </div>
                <div class="mb-3">
                    <label for="cpf" class="form-label">CPF (Apenas números)</label>
                    <input type="text" class="form-control" id="cpf">
                </div>
                <button onclick="salvar()" type="button" class="btn btn-primary">Salvar</button>
                <button type="button" onclick="login();" class="btn btn-secondary">Já tem conta? Faça seu login aqui!</button>
                <div class="form-check">
                    <input onclick="mostrarSenha()" type="checkbox" class="form-check-input" id="mostrarSenhaCheckbox">
                    <label class="form-check-label" for="mostrarSenhaCheckbox">Mostrar senha</label>
                </div>
            </form>
            <div id="error-message" style="color: red; margin-top: 10px;"></div>
            <br/>
        </div>
        <section class="fotoLateral">
            <div>
                <img src="/images/imagem_gerada (3).png" alt="foto de um torcedor vibrando pelo seu time">
            </div>
    </section>
    <script>
        const salvar = async () => {   
            var nome = document.getElementById('nome').value
            var email = document.getElementById('email').value;
            var senha = document.getElementById('senha').value;
            var confirmarsenha = document.getElementById('confirmarsenha').value;
            var endereco = document.getElementById('endereco').value;
            var cidade = document.getElementById('cidade').value;
            var estado = document.getElementById('estado').value;
            var data = document.getElementById('data').value;
            var cpf = document.getElementById('cpf').value;

            const regexSenha = /^(?=.*[A-Z])(?=.*[^A-Za-z0-9])(?=.{8,16}$)/;
            if (senha !== confirmarsenha) {
                document.getElementById('error-message').innerText = 'Senha e Confirmar Senha devem ser iguais.';
                return;
            }
            if (!regexSenha.test(senha)) {
                document.getElementById('error-message').innerText = 'A senha deve ter entre 8 e 16 caracteres, conter pelo menos uma letra maiúscula e um caractere especial.';
                return;
            }

            const response = await fetch(`http://localhost:3000/api/usuarios/verificar`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ email, cpf }),
            });

            const result = await response.json();
            if (result.exists) {
                alert('Conta já criada com esse email ou CPF.');
                return;
            }

            var data = {
                nome: nome,
                email: email,
                senha: senha,
                confirmarsenha: confirmarsenha,
                endereco: endereco,
                cidade: cidade,
                estado: estado,
                data_nascimento: data,
                cpf: cpf
            }
            
            const saveResponse = await fetch(`http://localhost:3000/api/cadastrese`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            }); 
            
            if (saveResponse.status === 201) {
                alert('Usuário cadastrado com sucesso!');
                window.location.href = 'login.html';
            } else {
                alert('Erro ao cadastrar usuário.');
            }
        };

        function mostrarSenha() {            
            var campoSenha = document.getElementById('senha');
            var campoConfirmarSenha = document.getElementById('confirmarsenha');

            if (campoSenha.type == 'text' || campoConfirmarSenha.type == 'text') {
                campoSenha.type = 'password';
                campoConfirmarSenha.type = 'password';
            } else {
                campoSenha.type = 'text';
                campoConfirmarSenha.type = 'text';
            }
        }

        const login = () => {
            window.location.href = 'login.html';
        }

        const home = () => {
            window.location.href = 'http://localhost:3000/index.html';
        }
    </script>

</body>

</html>
